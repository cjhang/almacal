# AMLACAL

This is the wiki page of number counting project affiliated of ALMACAL



### Introduction

1. The evolution of the number counts, whether we have resolved the all the extragalactic background
2. The nature of the faint SMG, counterparts of normal star-forming galaxies at high-z
3. the clutering of the faint SMG



### Advantages:

1. **Well-caibrated data**. Because the calibrator, we know whether the field is calibrated of not. Which means we can throw out the data corrupted by some unknown reasons
2. **Small cosmic covariance**. The calibrator are distributed in all the sky, which means the comic variance can be small comparing to the several deep field
3. **Self-calibration** to improve image fidelity 
4. **High-resolution**, reducing the uncertainty introduced by the unresolved multiple sources



### Disadvantage:

1. The calibrator are most blazers, which means that their flux may change from time to time. 
   - **One way to do is to subtract the point source in uv space in the each observation**
   - Directly imaging to get the average 
   - Try to model the variability of the blazer and then scale their flux?

2. The bias introduced by the Calibrator
   - Selection bias around blazer
   - Possible contamination from the resolve structure of the blazer 



[workflow](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiZmxvd2NoYXJ0IFREXG4gICAgQUxNQUNBTFtBTE1BQ0FMIG51bWJlciBjb3VudHNdIC0tPiBEYXRhWyhEYXRhKV1cbiAgICBBTE1BQ0FMW0FMTUFDQUwgbnVtYmVyIGNvdW50c10gLS0-IFNpbXVsYXRpb25bW1NpbXVsYXRpb25dXVxuIFxuICAgIHN1YmdyYXBoIFN0ZXAxIFtEYXRhIHByZS1wcm9jZXNzaW5nXVxuICAgIHV2ZGF0YSAtLT4gczFfMShjYWxpYnJhdGUgdGhlIGNhaWxpYnJhdG9yKVxuICAgIHV2ZGF0YSAtLT4gczFfMihzcGxpdCB0aGUgY2FsaWJyYXRvcilcbiAgICB1dmRhdGEgLS0-IHMxXzMocG9pbnQgc291cmNlIHN1YnRyYWN0aW9uKVxuICAgIHNwdyAtLT58Pz8_fCBhbGlnbm1lbnQoYWxpZ25lbWVudClcbiAgICBcbiAgICBlbmRcbiAgICBcbiAgICBzdWJncmFwaCBTdGVwMiBbSW1hZ2luZ11cbiAgICBpbWFnaW5nIC0tPiBzMl8xW2luZGl2aWR1YWwgaW1hZ2VzXVxuICAgIGltYWdpbmcgLS0-IHMyXzJbY29uYmluYXRpb25dXG4gICAgIHNvdXJjZV9leHRyYWN0aW9uW1NvdXJjZSBleHRyYWN0aW9uXSAtLT4gcmVzb2x1dGlvbihbUmVzb2x1dGlvbl0pXG4gICAgIHNvdXJjZV9leHRyYWN0aW9uW1NvdXJjZSBleHRyYWN0aW9uXSAtLT4gZWZmZWN0aXZlX2FyZWEoW0VmZmVjdGl2ZSBBcmVhXSlcbiAgICAgc291cmNlX2V4dHJhY3Rpb25bU291cmNlIGV4dHJhY3Rpb25dIC0tPiBzZXh0cmFjdG9yKFtzZXh0cmFjdG9yXSlcbiAgICBlbmRcblxuICAgIHN1YmdyYXBoIFN0ZXAzIFtOdW1iZXIgQ291bnRpbmddXG4gICAgc3VyZW5lc3NbU3VyZW5lc3NdIC0tPiBtdWx0aWJhbmQoW011bHRpYmFuZCBjb3VudGVycGFydF0pXG4gICAgZW5kXG4gIFxuXG4gICAgRGF0YSA9PT4gU3RlcDFcbiAgICBTdGVwMSA9PT4gU3RlcDJcbiAgICBTdGVwMiA9PT4gU3RlcDNcblxuICAgIFNpbXVsYXRpb24gLS0-IFRlc3RzXG4gICAgc3ViZ3JhcGggVGVzdHMgW1Rlc3RpbmddXG4gICAgczFbL0NvbXBsZXRlbmVzc1xcXSAtLS0gczJbL0ZsdXggYm9vc3RpbmdcXF0gLS0tfD8_P3wgczNbL1NlbGVjdGlvbiBiaWFzXFxdXG4gICAgZW5kXG4gICAgVGVzdHMgLS4tPiBTdGVwM1xuICAgIFN0ZXAzIC0tPiBjb21wYXJpc29tW0NvbXBhcmluZyB3aXRoIG1vZGVsc10iLCJtZXJtYWlkIjp7fSwidXBkYXRlRWRpdG9yIjpmYWxzZX0)

![hello](https://mermaid.ink/svg/eyJjb2RlIjoiZmxvd2NoYXJ0IFREXG4gICAgQUxNQUNBTFtBTE1BQ0FMIG51bWJlciBjb3VudHNdIC0tPiBEYXRhWyhEYXRhKV1cbiAgICBBTE1BQ0FMW0FMTUFDQUwgbnVtYmVyIGNvdW50c10gLS0-IFNpbXVsYXRpb25bW1NpbXVsYXRpb25dXVxuIFxuICAgIHN1YmdyYXBoIFN0ZXAxIFtEYXRhIHByZS1wcm9jZXNzaW5nXVxuICAgIHV2ZGF0YSAtLT4gczFfMShjYWxpYnJhdGUgdGhlIGNhaWxpYnJhdG9yKVxuICAgIHV2ZGF0YSAtLT4gczFfMihzcGxpdCB0aGUgY2FsaWJyYXRvcilcbiAgICB1dmRhdGEgLS0-IHMxXzMocG9pbnQgc291cmNlIHN1YnRyYWN0aW9uKVxuICAgIHNwdyAtLT58Pz8_fCBhbGlnbm1lbnQoYWxpZ25lbWVudClcbiAgICBcbiAgICBlbmRcbiAgICBcbiAgICBzdWJncmFwaCBTdGVwMiBbSW1hZ2luZ11cbiAgICBpbWFnaW5nIC0tPiBzMl8xW2luZGl2aWR1YWwgaW1hZ2VzXVxuICAgIGltYWdpbmcgLS0-IHMyXzJbY29uYmluYXRpb25dXG4gICAgIHNvdXJjZV9leHRyYWN0aW9uW1NvdXJjZSBleHRyYWN0aW9uXSAtLT4gcmVzb2x1dGlvbihbUmVzb2x1dGlvbl0pXG4gICAgIHNvdXJjZV9leHRyYWN0aW9uW1NvdXJjZSBleHRyYWN0aW9uXSAtLT4gZWZmZWN0aXZlX2FyZWEoW0VmZmVjdGl2ZSBBcmVhXSlcbiAgICAgc291cmNlX2V4dHJhY3Rpb25bU291cmNlIGV4dHJhY3Rpb25dIC0tPiBzZXh0cmFjdG9yKFtzZXh0cmFjdG9yXSlcbiAgICBlbmRcblxuICAgIHN1YmdyYXBoIFN0ZXAzIFtOdW1iZXIgQ291bnRpbmddXG4gICAgc3VyZW5lc3NbU3VyZW5lc3NdIC0tPiBtdWx0aWJhbmQoW011bHRpYmFuZCBjb3VudGVycGFydF0pXG4gICAgZW5kXG4gIFxuXG4gICAgRGF0YSA9PT4gU3RlcDFcbiAgICBTdGVwMSA9PT4gU3RlcDJcbiAgICBTdGVwMiA9PT4gU3RlcDNcblxuICAgIFNpbXVsYXRpb24gLS0-IFRlc3RzXG4gICAgc3ViZ3JhcGggVGVzdHMgW1Rlc3RpbmddXG4gICAgczFbL0NvbXBsZXRlbmVzc1xcXSAtLS0gczJbL0ZsdXggYm9vc3RpbmdcXF0gLS0tfD8_P3wgczNbL1NlbGVjdGlvbiBiaWFzXFxdXG4gICAgZW5kXG4gICAgVGVzdHMgLS4tPiBTdGVwM1xuICAgIFN0ZXAzIC0tPiBjb21wYXJpc29tW0NvbXBhcmluZyB3aXRoIG1vZGVsc10iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)



## Recordings of every day:

**Old logs**

The first file to carefully check the ears in the residual: `uid___A002_Xcd97a1_X3b27.ms` from `J1924-2914: B7` 

---

**20120-12-07**

The calibrator with Jet: J0635-7156

1. Careful manual calibration, try to find the difference

   - 2016.1.00203.S   B6   member.uid___A001_X87c_X8bf >> 

   - filename on HLTau: uid___A002_Xbf4033_X9d8.ms.split.cal.J0635-7516_B6

2. 10good vs 10bad, calibrator: J1717-3342

----------------------

**2020-12-08**

possibe difference between good residual and bad residuals (based on J1717-3342):

- [x] ~~integration time~~
- [x] ~~bandpass or gain calibrator~~
- [x] **uv coverage**, the good ones tend to have higher resolution
- [x] ~~spw window coverage~~. (maybe update the spw_stat to handle multiple vis)
- [x] ~~elevation angle~~

**thoughts**: 

1. ~~the non-detection could also be used to constrain the number density of the SMG, assuming a model~~, it is already considered when we calculate the effective area

-----------------------

**2020-12-09**

Plans for this week and maybe the following weeks:

- [ ] Better analysis the field of J0217-0820
  - [ ] test tclean with multi-threshold method
  - [ ] auto source detection
  - [ ] multi-band auto source confirmation
  - [ ] made the completeness and flux bootsting simulation
- [ ] An ancillary program to estimate the theoretical sensitivity? Based on the extrapolate values from the alma online calculator?
- [x] A program automatically find the good images. (Based on imstat results, and the fluxval if possible)
- [ ] modify the gen_image program to make images with different resolution, maybe three for each image? with resolution decrease three time one time

Another plan is making all your daily records online for the collaborators.

---

**2020-12-10**

Todo

- [ ] ~~Analysis the most prominent ear in J0217-0820~~, data still in property
- [x] ~~check the direction of ear with the direction of psf~~, **ears not always align with the psf, but somehow close to the major axis of the psf**

Possible ways to improve the point source subtraction:

- selfcal with `nterms=2`   
- selfcal with multiscale algorithms

-----------

**2020-12-17**

- [ ] Try to test the effect of time binning on the effect of ears

---

**2020-12-19**

- [ ] Check the noise distriution of dirty image, implemented in the check_image program

The testing files:

- the file cannot be found on ALMA archive: uid___A002_Xb4655b_X878
- the file to test the integrational time effect: `uid___A001_X133d_X1330/uid___A002_Xde8105_X761c.ms` (with initial 2.02s integration time?) calibrator:` J1717-3342`
- second file to test the integrational time effect: `uid___A001_X133d_X12be/uid___A002_Xde63ab_X85f2` (short integrational time, but with weak central residual). calibrator:` J1717-3342` 
  full HLtau name:`/science-ALMACAL/data/J1717-3342/uid___A002_Xde63ab_X85f2.ms.split.cal.J1717-3342_B6/`

---

**2020-12-20**

Notes for blcal: (surprise)

- no more cycle of amplitude selfcal needed
- cannot be implemeted together with caltable from gaincal
- another ms file to test blcal is: member.uid___A001_X1284_X426

---

**2020-12-21**

solution from blcal cannot always be trusted, if the final RMS is even much below the ALMA calculator prediction

need to do next:

- [x] Test blcal on the effects of off-center point source. Target: `J2148+0657: uid___A002_Xcda49e_Xdebb.ms` with the filename on HLtau is `uid___A002_Xcda49e_Xdebb.ms.split.cal.J2148+0657_B7`

  **blcal is not constrained for the amplitude, use with cautious**

---

**2020-12-23**

It seems that the additional bandpass and gaincal has no much effects on the final image. Beside, applying  the blcal after  the additional bandpass and gaincal also has no significant improvement

---

**2020-12-25**

Merry Christmas!

- [ ] **Test the time averaging and channal averaging on the final imaging quality.**

---

**2020-12-26**

- [x] ~~imaging the different spw separately~~

---

**2020-12-27**

- [ ] check the blcal effect on specific baselines
- [x] ~~imaging different scan seperately~~
- [ ] check the bandpass and gaincal solutions of good image
- [ ] remove time-variable term is neccesary prior standard calibration
- [x] ~~make standard calibration and point source subtraction with randomly chose antennae ls~~

---

**2020-12-28**

The ears persist in different time (or scan) and different sets of antennas, and the ear also change direction with differnt rime range (or scan)

---

**2020-12-30**

- [x] ~~check the image of different correlation~~

---

**2021-1-1**

Happy new year ðŸ¥³

The five typical bad image from J1924-2914

- `gen_all_image_run1/J1924-2914/B7/uid___A002_X80c782_X1597.ms.split.cal.J1924-2914_B7.cont.auto.fits ` (failed point source subtraction)
- `gen_all_image_run1/J1924-2914/B7/uid___A002_Xd1daeb_Xa834.ms.split.cal.J1924-2914_B7.cont.auto.fits` (ear and large scale)
- `gen_all_image_run1/J1924-2914/B7/uid___A002_Xe07f3e_X8f65.ms.split.cal.J1924-2914_B7.cont.auto.fits` (large scale and one-side ear)
- `gen_all_image_run1/J1924-2914/B7/uid___A002_Xb76b01_X10c2.ms.split.cal.J1924-2914_B7.cont.auto.fits` (large scale, five clouds)
- `gen_all_image_run1/J1924-2914/B7/uid___A002_Xb6d0c2_X96e6.ms.split.cal.J1924-2914_B7.cont.auto.fits` (large wave scale)

Example for good images from J2232+1143:

- `gen_all_image_run1/J2232+1143/B6/uid___A002_X6a533e_X15c7.ms.split.cal.J2232+117_B6.cont.auto.fits`
- `gen_all_image_run1/J2232+1143/B6/uid___A002_X877956_X606.ms.split.cal.J2232+117_B6.cont.auto.fits`



---

**2021-1-2**

- [ ] Checking the data combination from compact array and alam main array for one single observation with main array

---

**2021-1-13**

- [ ] show_images function, marked the center of the galaxies

- [ ] Using simalma to test the effect of resolved structure on the image of calibratorls

Oteo2016_list = ['J1303-5540', 'J1744-3116', 'J2206-0031', 'J1933-6942', 'J2223-3137', 'J1010-0200', 'J2148+0657', 'J0241-0815', 'J0108+0135', 'J1058+0133'] 

small files size: ['J1303-5540', 'J2206-0031', 'J1933-6942', 'J2223-3137', 'J1010-0200', 'J0241-0815', 'J0108+0135'] 

large files size: ['J1058+0133', 'J2148+0657', 'J1744-3116']



`check_image` pay attention to

- ./testing_goodimages_oteo2016/all_images/J0241-0815/B6/uid___A002_Xe37224_Xdcfd.ms.split.cal.J0241-0815_B6.cont.auto.fits

J1010-0200

```text
./testing_goodimages_oteo2016/all_images/J1010-0200/B6/uid___A002_Xe3da01_Xbf2d.ms.split.cal.J1010-0200_B6.cont.auto.fits
./testing_goodimages_oteo2016/all_images/J1010-0200/B6/uid___A002_X9e4650_X1dd9.ms.split.cal.J1010-0200_B6.cont.auto.fits
./testing_goodimages_oteo2016/all_images/J1010-0200/B6/uid___A002_Xe3da01_X3b23.ms.split.cal.J1010-0200_B6.cont.auto.fits
./testing_goodimages_oteo2016/all_images/J1010-0200/B6/uid___A002_Xe45e29_Xaee9.ms.split.cal.J1010-0200_B6.cont.auto.fits
./testing_goodimages_oteo2016/all_images/J1010-0200/B6/uid___A002_Xe50c9e_X58e9.ms.split.cal.J1010-0200_B6.cont.auto.fits

B7
./testing_goodimages_oteo2016/all_images/J1010-0200/B7/uid___A002_Xe3da01_X3d31.ms.split.cal.J1010-0200_B7.cont.auto.fits
```

---

**2021-02-03**

Four sources found by eye:

- `J0139+1753` B6
- `J1150+2417` B7, not in B6
- `J1512+0203` B6
- `J2253+1608` B6+B7

---

**2021-02-04**

Oteo2016_list = ['J1303-5540', 'J1744-3116', 'J2206-0031', 'J1933-6942', 'J2223-3137', 'J1010-0200', 'J2148+0657', 'J0241-0815', 'J0108+0135', 'J1058+0133'] 

Passed: [J1933-6942, J2148+0657, J0241-0815]

Partial Passed: [J0241-0815, J2206-0031] 

Not passed: [J1010-0200, J1744-3116]

- [x] `J1010-0200` ~~cannot detect any source, find why~~, so many failed point source subtraction
- [x] `J2206-0031` B7 and `J1303-5540`B6, `J0108+0135`B7, ~~uvtaper2.0 cannot pass, find why,~~ signal_to_noisy ratio has decreased
- [x] `J2223-3137` B6, ~~uvtaper1.0 and 2.0 cannot pass~~, too strict  image selection criteria, most images were rejected
- [x] `J1744-3116` ~~cannot find the B7 detection~~, failed point source subtraction
- [x] `J2148+0657` ~~B6 with strong noise~~, true bad
- [x] `J1058+0133` ~~not passed the good image selection~~, failed point source subtraction

---

2021-02-13

files with split problems:

- uid___A002_X984bbe_X21d2.ms.split.cal.J1058+0133_B6
- uid___A002_X9652ea_X220.ms.split.cal.J1058+0133_B6
- uid___A002_X9630c0_X1719.ms.split.cal.J1058+0133_B6

---

2021-02-14

1. ~~the effects of uvtaper for source finding~~
2. ~~random insert, measure flux for clean image, without pbcorrection, without change the direction~~, no need
3. ~~completeness, flux boosting, whether test different vutaper~~, only the one used for finder point source can be enough

---

2021-02-15

- [ ] [debian] Find the best parameter for oteo2016
- [ ] [debian]Testing the flux boosting with flux inserted by SNR not the flux density
- [ ] [debian] Random source generator with primary beam units
- [ ] [hltau] Test five source with completeness and flux density
- [ ] [hltau] Testing effects of different UVtaper on completeness and flux density 

